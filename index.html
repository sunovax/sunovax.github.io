<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SunovaX Charging Station</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
*{
  box-sizing:border-box;
  font-family:'Poppins',sans-serif;
}

body{
  margin:0;
  min-height:100vh;
  background:
    radial-gradient(circle at top, rgba(255,215,100,0.25), transparent 60%),
    linear-gradient(135deg,#0b1f2a,#0e2a3b,#081821);
  display:flex;
  align-items:center;
  justify-content:center;
  color:white;
  overflow:hidden;
}

/* Sun pulse */
.sun{
  position:absolute;
  top:-120px;
  width:320px;
  height:320px;
  background:radial-gradient(circle,#ffd84d,#ffb703,transparent 65%);
  border-radius:50%;
  animation:pulse 4s infinite ease-in-out;
}

@keyframes pulse{
  0%,100%{transform:scale(1);opacity:0.9;}
  50%{transform:scale(1.08);opacity:1;}
}

/* Rays */
.rays{
  position:absolute;
  width:600px;
  height:600px;
  background:conic-gradient(from 0deg, rgba(255,216,77,0.25), transparent 40%);
  animation:rotate 18s linear infinite;
}

@keyframes rotate{
  to{transform:rotate(360deg);}
}

.container{
  position:relative;
  z-index:2;
  width:100%;
  max-width:420px;
  background:rgba(255,255,255,0.08);
  backdrop-filter:blur(16px);
  border-radius:24px;
  padding:32px;
  box-shadow:0 25px 50px rgba(0,0,0,0.4);
  text-align:center;
  animation:fadeUp 0.8s ease;
}

@keyframes fadeUp{
  from{opacity:0;transform:translateY(20px);}
  to{opacity:1;transform:translateY(0);}
}

h1{
  font-size:30px;
  margin-bottom:6px;
  color:#ffd84d;
}

h2{
  font-size:15px;
  opacity:0.85;
  margin-bottom:22px;
}

.step{display:none;}
.step.active{display:block;}

input{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:none;
  margin-top:8px;
  font-size:15px;
}

.label{
  font-size:13px;
  opacity:0.8;
  text-align:left;
}

.btn{
  margin-top:18px;
  padding:14px;
  border:none;
  border-radius:14px;
  width:100%;
  background:linear-gradient(135deg,#ffd84d,#ffb703);
  color:#000;
  font-weight:600;
  font-size:16px;
  cursor:pointer;
}

.btn:active{transform:scale(0.97);}

.info{
  margin-top:16px;
  background:rgba(0,0,0,0.25);
  padding:16px;
  border-radius:14px;
}

.wait{
  animation:blink 1.6s infinite;
}

@keyframes blink{
  0%,100%{opacity:1;}
  50%{opacity:0.6;}
}
</style>
</head>

<body>

<div class="sun"></div>
<div class="rays"></div>

<div class="container">

  <!-- STEP 1 -->
  <div class="step active" id="s1">
    <h1>SunovaX ‚òÄÔ∏è</h1>
    <h2>Clean ‚Ä¢ Smart ‚Ä¢ Electric</h2>
    <button class="btn" onclick="go(2)">Start Charging</button>
  </div>

  <!-- STEP 2 -->
  <div class="step" id="s2">
    <h1>Battery Details</h1>

    <div class="label">Current Charge (%)</div>
    <input type="number" id="current" min="0" max="100">

    <div class="label" style="margin-top:10px;">Required Charge (%)</div>
    <input type="number" id="target" min="1" max="100">

    <button class="btn" onclick="calc()">Continue</button>
  </div>

  <!-- STEP 3 -->
  <div class="step" id="s3">
    <h1>Payment</h1>
    <div class="info" id="amountBox"></div>
    <button class="btn" onclick="paid()">Paid</button>
  </div>

  <!-- STEP 4 -->
  <div class="step" id="s4">
    <h1>Waiting</h1>
    <div class="info wait">
      Waiting for Admin Verification‚Ä¶
    </div>
  </div>

  <!-- STEP 5 -->
  <div class="step" id="s5">
    <h1>Charging Enabled üîå</h1>
    <div class="info">
      Admin approved charging.<br><br>
      Please plug in your phone.<br>
      Do not unplug until charging completes.
    </div>
  </div>

</div>

<!-- FIREBASE + LOGIC -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import {
  getFirestore,
  doc,
  setDoc,
  onSnapshot
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBYWFWFQaJZ-i4GU12tlCvLNjfY1s3aeJQ",
  authDomain: "sunovax.firebaseapp.com",
  projectId: "sunovax"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const sessionId = "sess_" + Date.now();

/* üî¥ FIX: make functions GLOBAL */
window.go = function(n){
  document.querySelectorAll(".step").forEach(s=>s.classList.remove("active"));
  document.getElementById("s"+n).classList.add("active");
}

window.calc = function(){
  const c = +current.value;
  const t = +target.value;
  if(isNaN(c) || isNaN(t) || c >= t){
    alert("Enter valid charge values");
    return;
  }
  const diff = t - c;
  amountBox.innerHTML = `Pay <b>‚Çπ${diff}</b><br>(‚Çπ1 per 1%)`;
  go(3);
}

window.paid = async function(){
  await setDoc(doc(db,"sessions",sessionId),{
    paid:true,
    adminApproved:false,
    charging:false,
    created:Date.now()
  });
  go(4);
}

onSnapshot(doc(db,"sessions",sessionId),(snap)=>{
  if(snap.exists() && snap.data().charging === true){
    go(5);
  }
});
</script>

</body>
</html>
