<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SUNOVAX Charging</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;font-family:Poppins}
body{
  margin:0;min-height:100vh;
  display:flex;justify-content:center;align-items:center;
  background:linear-gradient(135deg,#081821,#0e2a3b);
  color:#fff;
}
.page{
  width:360px;padding:30px;
  background:rgba(255,255,255,.08);
  backdrop-filter:blur(16px);
  border-radius:24px;
  text-align:center;
  display:none;
  animation:fade .4s ease;
}
.page.active{display:block}
@keyframes fade{from{opacity:0;transform:scale(.95)}}
h1{color:#ffd84d;margin-bottom:6px}
button{
  margin-top:18px;width:100%;
  padding:14px;border:none;border-radius:14px;
  background:linear-gradient(135deg,#ffd84d,#ffb703);
  font-weight:600;font-size:16px;
}
input{
  width:100%;padding:12px;border:none;
  border-radius:12px;margin-top:10px;
}
</style>
</head>

<body>

<!-- WELCOME -->
<div id="welcome" class="page active">
  <h1>SUNOVAX ‚òÄÔ∏è</h1>
  <p>Smart ‚Ä¢ Clean ‚Ä¢ Renewable Energy</p>
  <button onclick="go('battery')">Start Charging</button>
</div>

<!-- BATTERY -->
<div id="battery" class="page">
  <h1>Battery Info</h1>
  <input id="cur" type="number" placeholder="Current %">
  <input id="req" type="number" placeholder="Required %">
  <button onclick="calc()">Continue</button>
</div>

<!-- PAYMENT -->
<div id="payment" class="page">
  <h1>Payment</h1>
  <p id="payText"></p>
  <button onclick="paid()">PAID</button>
</div>

<!-- WAITING -->
<div id="waiting" class="page">
  <h1>Waiting ‚è≥</h1>
  <p>Waiting for admin confirmation‚Ä¶</p>
</div>

<!-- PLUG IN -->
<div id="plugin" class="page">
  <h1>Plug In üîå</h1>
  <p id="timeText"></p>
</div>

<!-- THANK YOU -->
<div id="thankyou" class="page">
  <h1>Thank You üåû</h1>
  <p>Charging started using clean energy.</p>
</div>

<script type="module">
import {initializeApp} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import {
  getFirestore,collection,addDoc,onSnapshot,doc,getDocs
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const app = initializeApp({
  apiKey:"AIzaSyBYWFWFQaJZ-i4GU12tlCvLNjfY1s3aeJQ",
  projectId:"sunovax"
});
const db = getFirestore(app);

let ref, mins=0;

/* ROUTER */
function showPage(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  location.hash=id;
}
window.go = showPage;

window.addEventListener("load",()=>{
  const p=location.hash.replace("#","")||"welcome";
  showPage(p);
});

/* CALC */
window.calc=()=>{
  const c=+cur.value,r=+req.value;
  if(r<=c||!c||!r) return alert("Invalid values");
  mins=r-c;
  payText.innerHTML=`Amount to Pay: <b>‚Çπ${mins}</b>`;
  showPage("payment");
};

/* PAID */
window.paid=async()=>{
  const snap=await getDocs(collection(db,"sessions"));
  const userNo=snap.size+1;

  ref=await addDoc(collection(db,"sessions"),{
    name:`User ${userNo}`,
    company:"SUNOVAX",
    paid:true,
    verified:false,
    charging:false,
    createdAt:Date.now(),
    duration:mins*60
  });

  showPage("waiting");

  onSnapshot(doc(db,"sessions",ref.id),s=>{
    if(!s.exists()) location.reload();
    if(s.data().charging){
      timeText.innerHTML=`Estimated Time: <b>${mins} minutes</b>`;
      showPage("plugin");
      setTimeout(()=>showPage("thankyou"),4000);
    }
  });
};
</script>

</body>
</html>
