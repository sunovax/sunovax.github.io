<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SUNOVAX Charging Station</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;font-family:'Poppins',sans-serif;margin:0;padding:0}

body{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  background:linear-gradient(135deg,#081821,#0e2a3b,#0b1f2a);
  color:#fff;
}

.container{
  width:100%;
  max-width:420px;
  background:rgba(255,255,255,0.08);
  backdrop-filter:blur(16px);
  border-radius:24px;
  padding:30px;
  text-align:center;
}

.logo{
  font-size:42px;
  font-weight:700;
  color:#ffd84d;
}

.tagline{
  font-size:14px;
  opacity:.85;
  margin-bottom:30px;
}

.step{display:none}
.step.active{display:block}

input{
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  margin:10px 0;
}

button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:14px;
  background:linear-gradient(135deg,#ffd84d,#ffb703);
  font-weight:600;
  cursor:pointer;
}

.info{
  margin-top:15px;
  background:rgba(0,0,0,.25);
  padding:15px;
  border-radius:14px;
}

.timer{
  font-size:22px;
  margin-top:10px;
  color:#7CFC98;
}
</style>
</head>

<body>

<div class="container">

  <div class="step active" id="s1">
    <div class="logo">SUNOVAX ‚òÄÔ∏è</div>
    <div class="tagline">Smart ‚Ä¢ Clean ‚Ä¢ Renewable Energy</div>
    <button onclick="go(2)">Start Charging</button>
  </div>

  <div class="step" id="s2">
    <h3>Current Battery %</h3>
    <input type="number" id="current" placeholder="Eg: 40">
    <button onclick="createSession()">Continue</button>
  </div>

  <div class="step" id="s3">
    <h3>Plug In Your Phone üîå</h3>
    <div class="info" id="details"></div>
    <div class="timer" id="timer">00:00:00</div>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getFirestore, collection, addDoc, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const app = initializeApp({
  apiKey:"AIzaSyBYWFWFQaJZ-i4GU12tlCvLNjfY1s3aeJQ",
  projectId:"sunovax"
});
const db = getFirestore(app);

let sessionRef;
let timerInt;

window.go = n =>{
  document.querySelectorAll(".step").forEach(s=>s.classList.remove("active"));
  document.getElementById("s"+n).classList.add("active");
}

window.createSession = async ()=>{
  const cur = +document.getElementById("current").value;
  if(isNaN(cur)||cur>=100) return alert("Invalid value");

  const need = 100-cur;
  const duration = need * 60; // 1% = 1 min

  sessionRef = await addDoc(collection(db,"sessions"),{
    paid:true,
    adminApproved:false,
    charging:false,
    duration,
    createdAt:Date.now()
  });

  document.getElementById("details").innerHTML =
    `Required: <b>${need}%</b><br>Estimated time: <b>${need} min</b>`;

  go(3);

  onSnapshot(doc(db,"sessions",sessionRef.id),snap=>{
    if(!snap.exists()){
      clearInterval(timerInt);
      alert("Session Ended");
      location.reload();
      return;
    }

    const d=snap.data();
    if(d.charging && d.endsAt){
      startTimer(d.endsAt);
    }
  });
}

function startTimer(end){
  clearInterval(timerInt);
  timerInt=setInterval(()=>{
    const t=end-Date.now();
    if(t<=0) clearInterval(timerInt);
    const h=Math.floor(t/3600000);
    const m=Math.floor(t/60000)%60;
    const s=Math.floor(t/1000)%60;
    timer.textContent=
      `${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
  },1000);
}
</script>
</body>
</html>
